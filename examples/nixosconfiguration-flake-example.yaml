apiVersion: nixos.infra/v1alpha1
kind: NixosConfiguration
metadata:
  name: ultra-flake-config
  namespace: default
spec:
  # Использование флейка из репозитория
  gitRepo: "https://github.com/homystack/NIO"
  flake: "#custom-server"
  onRemoveFlake: "#minimal"
  configurationSubdir: "examples/nix"  # Поддиректория с Nix конфигурациями
  
  # Ссылка на машину
  machineRef:
    name: machine-b0-41-6f-10-7e-42
  
  # Настройки для флейков
  fullInstall: true 
  
  # Примеры использования additionalFiles (PRD requirement)
  additionalFiles:
    # Inline файл - статическое содержимое
    - path: "config/static-config.nix"
      valueType: Inline
      inline: |
        { config, pkgs, ... }:
        {
          # Статическая конфигурация
          networking.hostName = "custom-server";
          services.nginx.enable = true;
        }
    
    # SecretRef - динамическое содержимое из Kubernetes Secret
    - path: "flake-ssh-private-key"
      valueType: SecretRef
      secretRef:
        name: ssh-private-key-b0-41-6f-10-7e-42

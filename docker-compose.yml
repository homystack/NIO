version: '3.8'

services:

  # # Оператор в режиме разработки
  nio:
    # image: ghcr.io/homystack/nio:main
    build:
      context: .
      dockerfile: Containerfile
    volumes:
      - .:/app
      - ~/.kube/config:/app/.kube/config
    environment:
      - PYTHONPATH=/app
      - PYTHONUNBUFFERED=1
      - PYDEVD_DISABLE_FILE_VALIDATION=1 
    ports:
      - "5679:5678"  # Python debugger port

  # PXE сервер для загрузки машин через iPXE
  nio-ipxe:
    build:
      context: .
      dockerfile: Containerfile.ipxe
    network_mode: host
    volumes:
      - .:/app
      - .pxe:/app/.pxe
      - ~/.kube/config:/app/.kube/config
    environment:
      - PYTHONPATH=/app
      - PYTHONUNBUFFERED=1
    command: python ipxe.py
    privileged: true
